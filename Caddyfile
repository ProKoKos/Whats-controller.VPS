wmoc.online {
    # Логирование
    log {
        output file /var/log/caddy/access.log
        format json
    }

    # API routes - используем имя сервиса из docker-compose
    reverse_proxy /api/* api:3000 {
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-For {remote_host}
        header_up X-Forwarded-Proto {scheme}
    }

    # Controller proxy routes
    reverse_proxy /c/* api:3000 {
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-For {remote_host}
        header_up X-Forwarded-Proto {scheme}
    }

    # WebSocket tunnel
    reverse_proxy /tunnel api:3000 {
        transport http {
            read_timeout 3600s
            write_timeout 3600s
        }
        header_up Connection {>Connection}
        header_up Upgrade {>Upgrade}
    }

    # Health check
    handle /health {
        reverse_proxy api:3000
    }

    # Frontend (будет добавлено позже)
    # file_server {
    #     root /var/www/wmoc-frontend
    # }
}

# HTTP to HTTPS redirect происходит автоматически
# Caddy автоматически получит SSL сертификат для wmoc.online

