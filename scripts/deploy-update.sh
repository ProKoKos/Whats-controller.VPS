#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

set -e

echo "üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ WMOC –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ..."
echo ""

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
cd ~/wmoc-server/server || {
    echo "‚ùå –ü–∞–ø–∫–∞ ~/wmoc-server/server –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
    exit 1
}

echo "üì• –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è..."
git pull

if [ $? -ne 0 ]; then
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ git pull"
    exit 1
fi

echo "‚úÖ –ö–æ–¥ –æ–±–Ω–æ–≤–ª—ë–Ω"
echo ""

echo "üê≥ –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ frontend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞..."
docker compose up -d --build frontend

if [ $? -eq 0 ]; then
    echo ""
    echo "‚úÖ Frontend –æ–±–Ω–æ–≤–ª—ë–Ω –∏ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω"
    echo ""
    echo "üìä –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:"
    docker compose ps
else
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–µ frontend"
    exit 1
fi

echo ""
echo "üéâ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"

